---
name: ✅ 开发任务
about: 项目中的开发/实现任务
title: "[Task] 🧪 完善API自动化测试套件"
labels: task,testing,api
assignees: ""
---

## 功能 / 任务标题
> 基于PDF文档完善API自动化测试套件

### 需求依据
- 基于`docs/tech/Web订餐管理系统.pdf`的API功能要求
- 当前API测试覆盖率不足（仅18个测试）
- 缺少API响应数据验证机制
- 需要模块化的API测试管理
- 前置任务：🔨 建立自动化测试框架基础架构

### 具体操作
1. **迁移现有API测试脚本到新框架**
   - `test_backend_api.sh` → `scripts/api/basic_api_test.sh`
   - 模块化测试函数（按功能域拆分）
   - 统一测试接口格式
   - 集成到新的测试运行器

2. **按功能域创建专用测试脚本**
   - `scripts/api/user_api_test.sh` - 用户管理API测试
     - 用户注册、登录、信息获取
     - 参数验证和错误处理
   - `scripts/api/menu_api_test.sh` - 菜单管理API测试
     - 分类查询、菜品查询
     - 菜品详情和推荐
   - `scripts/api/order_api_test.sh` - 订单管理API测试
     - 订单创建、查询、状态管理
     - 订单项和价格计算
   - `scripts/api/cart_api_test.sh` - 购物车API测试（占位符）
     - 购物车增删改查
     - 购物车结算功能

3. **实现API响应验证机制**
   - 状态码验证（200/400/403/404/500）
   - JSON格式验证（语法正确性）
   - 数据内容验证（字段类型、值范围）
   - 响应时间验证（性能要求）
   - 错误信息格式验证

4. **建立API测试数据管理**
   - 测试数据隔离（每个测试独立数据集）
   - 数据清理机制（测试后自动清理）
   - 数据依赖管理（测试用例间数据共享）
   - 测试数据版本控制

### 交付物
- 模块化的API测试脚本套件
- API响应验证库 (`scripts/core/validation.sh`)
- 测试数据管理脚本 (`scripts/core/data_manager.sh`)
- API测试覆盖报告（Markdown格式）
- API测试执行指南

### 验收
1. **功能调用结果符合需求**
   - 所有现有API都有对应测试用例
   - 缺失API有测试占位符（标记为TODO）
   - API响应验证机制工作正常
   - 测试数据管理自动化

2. **测试数据正确写入 / 返回**
   - 测试数据正确初始化
   - API操作对数据库的影响正确验证
   - 测试数据正确清理
   - 测试结果统计准确

3. **项目启动后无报错**
   - 所有API测试脚本可独立运行
   - 集成到测试运行器无错误
   - 测试报告生成正常
   - 日志记录完整

### 任务关联
- **前置任务**: 🔨 建立自动化测试框架基础架构
- **后续任务**:
  - 🔐 构建权限与安全测试体系
  - 📊 创建数据库验证测试框架
  - 🔄 实现业务流程集成测试

### 测试用例要求
基于PDF文档的API要求，至少覆盖：
- **用户管理API**: 注册、登录、信息获取
- **分类管理API**: 分类列表、分类详情、按名称查询
- **菜单管理API**: 菜单查询、分类筛选、推荐菜品
- **订单管理API**: 订单创建、查询、状态更新
- **购物车API**: 添加商品、查看购物车、结算（占位符）
- **管理员API**: 用户管理、菜单管理、订单管理

### 备注
需要特别关注PDF文档中规定的三种用户角色（游客、会员、管理员）对API的不同访问权限。
此任务将为API功能开发提供完整的测试覆盖，确保后续API修改和扩展都有相应的测试验证。